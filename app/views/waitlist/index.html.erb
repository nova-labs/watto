<% @callout = waitlist_callouts %>

<% content_for :title, "Class Waitlist" %>

<% content_for :breadcrumbs do %>
  <%= crumb "Waitlist", active: true %>
  <%#= crumb "Registrations", to: waitlist_registrations_path %>
<% end %>


<%= render "shared/flash" %>

<div class="container my-4">
  <% unless current_user %>
    <div class="alert alert-warning d-flex align-items-center" role="alert">
      <div>
        You're not logged in. You can still register as a guest, but logging in makes it easier for us to contact you (and saves you from typing the same info twice).
        <a href="<%= login_path %>" class="alert-link">Log in</a> if you have an account. Please and thank you.
      </div>
    </div>
  <% end %>
  <div class="bg-light border rounded p-3 shadow-sm">
    <div class="d-flex flex-wrap justify-content-between align-items-center">
      <div>
        <h5 class="mb-1 fw-semibold"><%= @callout[:title] %></h5>
        <p class="mb-2 small text-muted"><%= @callout[:description] %></p>
      </div>
      <div class="d-flex flex-wrap gap-2">
        <a href="#SIGN_OFF_CLASS" class="btn btn-sm btn-outline-primary">Sign-off Classes</a>
        <a href="#PROJECT_CLASS" class="btn btn-sm btn-outline-primary">Project Classes</a>
        <% if current_user&.signoffer? %>
          <a href="<%= waitlist_google_sheet_url %>" class="btn btn-sm btn-outline-secondary"><i class="fas fa-external-link-alt" aria-hidden="true"></i> Waitlist Google Sheet</a>
        <% end %>
      </div>
    </div>

    <div class="mt-2 position-relative">
      <a href="#classInfoCollapse"
         class="text-muted small text-decoration-underline"
         data-bs-toggle="collapse"
         role="button"
         aria-expanded="false"
         aria-controls="classInfoCollapse">
        What does this mean?
      </a>
      <div class="collapse mt-2" id="classInfoCollapse">
        <div class="bg-white border rounded p-2 small">
          <p class="mb-1">Nova Labs offers:</p>
          <ul class="mb-1">
            <li><strong>Sign-off Classes</strong>: Required before using specific tools.</li>
            <li><strong>Project Classes</strong>: Build cool stuff, may have prerequisites.</li>
          </ul>
          <p class="mb-0">Popular classes may have waitlists. Others are first-come, first-served.</p>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="container">
  <% @groups.each do |key, items| %>
    <% next if key.blank? %>

    <div class="row mt-5 mb-3">
      <div class="col-12 col-md-8">
        <h3 id="<%= key %>" class="d-inline-block me-3 mb-0"><%= key.downcase.titleize.pluralize %></h3>
      </div>
    </div>

    <% items.each do |item| %>
      <% next if item['is_hidden'] == "TRUE" %>

      <div class="row border-bottom py-1">
        <div class="col-12 col-lg-8 d-flex align-items-center">
          <span class="me-2"><%= shop_badge_from_name(item['code']) %></span>
          <%= item['name'] %>
        </div>

        <div class="col-12 col-lg-4 mt-2 mt-lg-0">
          <div class="flex-column flex-xs-row flex-lg-row justify-content-end align-items-end align-items-lg-center text-end gap-1">
            <% if item['is_waitlist_enabled'] == 'TRUE' %>
              <%= link_to "Join Waitlist", new_waitlist_registration_path(c: item['code_and_name']), class: "btn btn-sm btn-outline-primary w-auto" %>
            <% else %>
              <small class="text-muted">No waitlist required</small>
              <%= link_to 'Search for class', events_path(q: item['code']), class: "btn btn-sm btn-outline-secondary w-auto" %>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
  <% end %>
</div>


